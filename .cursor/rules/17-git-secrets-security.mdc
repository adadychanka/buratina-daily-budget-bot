---
title: Git Secrets Security Scanning
description: git-secrets integration for preventing secret leaks in commits
priority: 2
tags: [security, git-secrets, secrets, pre-commit, hooks]
---

# Git Secrets Security Scanning

## Overview

This project uses [git-secrets](https://github.com/awslabs/git-secrets) from AWS Labs to automatically detect and prevent committing secrets (API keys, passwords, tokens) to the repository. git-secrets scans staged files before commits and entire repository history before pushes.

## Installation

### System Requirements

git-secrets must be installed system-wide (one-time setup per developer):

```bash
git clone https://github.com/awslabs/git-secrets.git
cd git-secrets
sudo make install
```

### Repository Setup

After installing git-secrets system-wide:

```bash
# Initialize git-secrets in repository
npm run secrets:init

# Configure detection patterns
npm run secrets:setup
```

## How It Works

### Pre-commit Hook

The `.husky/pre-commit` hook automatically scans **staged files only** before each commit:

```bash
# Scan staged files for secrets
if git secrets --list >/dev/null 2>&1; then
  git secrets --scan --cached || exit 1
else
  echo "⚠️  Warning: git-secrets is not installed. Skipping secrets scan."
fi
```

- ✅ Fast (only checks staged files)
- ✅ Prevents secrets from entering repository
- ⚠️ Shows warning if git-secrets not installed (doesn't block commit)

### Pre-push Hook

The `.husky/pre-push` hook scans **entire repository history** before push:

```bash
# Scan entire repository history for secrets
if git secrets --list >/dev/null 2>&1; then
  git secrets --scan-history || exit 1
else
  echo "⚠️  Warning: git-secrets is not installed. Skipping secrets scan."
fi
```

- ✅ Thorough (checks entire history)
- ✅ Catches secrets that might have been missed
- ⚠️ Shows warning if git-secrets not installed (doesn't block push)

## Configured Patterns

The project scans for these secret patterns:

### AWS Patterns

Automatically registered via `git secrets --register-aws`:
- AWS Access Key IDs
- AWS Secret Access Keys
- AWS Account IDs
- Other AWS credentials

### Custom Patterns

Configured in `scripts/secrets-setup.sh`:

```bash
# Telegram bot tokens
git secrets --add '.*[Bb][Oo][Tt][_ ]?[Tt][Oo][Kk][Ee][Nn].*'

# Google API keys
git secrets --add '.*[Gg][Oo][Oo][Gg][Ll][Ee][_ ]?[Aa][Pp][Ii][_ ]?[Kk][Ee][Yy].*'

# Private keys
git secrets --add '.*[Pp][Rr][Ii][Vv][Aa][Tt][Ee][_ ]?[Kk][Ee][Yy].*'
```

## Available npm Scripts

### secrets:check

Check if git-secrets is installed:

```bash
npm run secrets:check
```

**Location:** `scripts/secrets-check.sh`

### secrets:init

Initialize git-secrets in the repository:

```bash
npm run secrets:init
```

**Location:** `scripts/secrets-init.sh`

**Note:** This may conflict with existing Husky hooks. The hooks are already configured manually, so this command may not be necessary.

### secrets:setup

Configure detection patterns:

```bash
npm run secrets:setup
```

**Location:** `scripts/secrets-setup.sh`

Runs automatically:
- Registers AWS patterns
- Adds custom patterns for bot tokens, API keys, private keys

## Scripts Structure

All git-secrets scripts are located in `scripts/` directory:

```
scripts/
├── secrets-check.sh   # Check if git-secrets is installed
├── secrets-init.sh    # Initialize git-secrets hooks
└── secrets-setup.sh   # Configure detection patterns
```

### Scripts Best Practices

✅ **Do:**

```bash
#!/bin/bash
# Script description

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"

cd "$PROJECT_ROOT" || exit 1

# Check dependencies
"$SCRIPT_DIR/secrets-check.sh" || exit 1

# Execute commands
```

- Use absolute paths for script location
- Check dependencies before execution
- Provide clear error messages
- Exit with proper codes

❌ **Don't:**

```bash
#!/bin/bash
# Script without error handling
cd scripts
# Hard-coded paths
# No dependency checks
```

- Hard-code paths
- Skip dependency checks
- Ignore errors
- Use relative paths without validation

## Handling False Positives

### Adding Allowed Patterns

If git-secrets detects a false positive (safe pattern that looks like a secret):

```bash
# Add allowed pattern globally
git secrets --add --allowed "your-safe-pattern"

# Add allowed pattern for specific file
git secrets --add --allowed "process\.env\.BOT_TOKEN"
```

### Common False Positives

The following patterns are already allowed:

```bash
# Documentation files
git secrets --add --allowed '.*\.md$'
git secrets --add --allowed '.*\.mdc$'

# Example files
git secrets --add --allowed '.*env\.example$'

# Configuration templates
git secrets --add --allowed '.*docker-compose.*\.yml$'

# Code patterns (not actual secrets)
git secrets --add --allowed 'process\.env\.BOT_TOKEN'
git secrets --add --allowed 'botToken.*config'
```

## Troubleshooting

### git-secrets not found

**Error:** `git: 'secrets' is not a git command`

**Solution:**
1. Install git-secrets system-wide (see Installation)
2. Verify: `git secrets --list` should work

### Hooks not running

**Problem:** Pre-commit/pre-push hooks not executing

**Solution:**
```bash
# Reinstall Husky
npm run prepare

# Verify hooks exist
ls -la .husky/
```

### False positives blocking commits

**Problem:** Valid code detected as secret

**Solution:**
```bash
# Add allowed pattern
git secrets --add --allowed "your-pattern"

# Or use --no-verify for one-time bypass (NOT recommended)
git commit --no-verify
```

### Pattern already exists

**Error:** Pattern already registered

**Solution:** This is normal. Patterns are idempotent - running setup multiple times is safe.

## Integration with Development Workflow

### New Developer Setup

1. **Clone repository**
2. **Install git-secrets system-wide**
3. **Run setup:**
   ```bash
   npm run secrets:setup
   ```

### Adding New Secret Patterns

1. **Edit `scripts/secrets-setup.sh`**
2. **Add new pattern:**
   ```bash
   git secrets --add 'your-pattern-regex' || true
   ```
3. **Test locally:**
   ```bash
   npm run secrets:setup
   ```
4. **Commit changes**

### CI/CD Integration

For CI/CD pipelines, ensure git-secrets is installed:

```yaml
# Example GitHub Actions
- name: Install git-secrets
  run: |
    git clone https://github.com/awslabs/git-secrets.git
    cd git-secrets
    sudo make install

- name: Check for secrets
  run: |
    git secrets --scan-history
```

## Security Best Practices

### ✅ Do

- **Always run setup** after cloning repository
- **Review detected patterns** before adding to allowed list
- **Use specific patterns** for allowed items (not too broad)
- **Document allowed patterns** when adding them
- **Test hooks** after setup

### ❌ Don't

- **Don't bypass hooks** with `--no-verify` unless absolutely necessary
- **Don't add overly broad allowed patterns** (e.g., allowing all `.ts` files)
- **Don't commit actual secrets** even if they pass git-secrets
- **Don't remove git-secrets** from hooks
- **Don't ignore warnings** about missing git-secrets

## Related Rules

- **10-security-practices.mdc** - General security practices
- **09-git-flow-workflow.mdc** - Git workflow standards

## References

- [git-secrets GitHub Repository](https://github.com/awslabs/git-secrets)
- [AWS git-secrets Documentation](https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/scan-git-repositories-for-sensitive-information-and-security-issues-by-using-git-secrets.html)
